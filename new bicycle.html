<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRH Bicycle System</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f0f2f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background-color: #3f51b5;
            color: white;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            text-align: center;
            margin: 0;
        }

        /* Navigation Tabs */
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-button {
            flex: 1;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #e8eaf6;
            color: #3f51b5;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: #c5cae9;
        }

        .tab-button.active {
            background: #3f51b5;
            color: white;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card-title {
            color: #3f51b5;
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3f51b5;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #3f51b5;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Button Styles */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn-primary {
            background: #3f51b5;
            color: white;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #3f51b5;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-returned {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-maintenance {
            background: #fff3e0;
            color: #ef6c00;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 4px;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }

        .notification.success {
            background: #4caf50;
        }

        .notification.error {
            background: #f44336;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white;
            }
            
            .container {
                padding: 0;
                max-width: none;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .tab-container {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .btn {
                width: 100%;
                margin-bottom: 5px;
            }

            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HRH Bicycle System</h1>
        </div>

        <div class="tab-container no-print">
            <button class="tab-button active" onclick="showTab('issue')">Issue Bicycle</button>
            <button class="tab-button" onclick="showTab('return')">Return Bicycle</button>
            <button class="tab-button" onclick="showTab('maintenance')">Maintenance</button>
            <button class="tab-button" onclick="showTab('reports')">Reports</button>
        </div>

        <!-- Tab content divs will go here -->
        <div id="issueTab" class="tab-content active">
            <!-- Issue tab content -->
        </div>

        <div id="returnTab" class="tab-content" style="display: none;">
            <!-- Return tab content -->
        </div>

        <div id="maintenanceTab" class="tab-content" style="display: none;">
            <!-- Maintenance tab content -->
        </div>

        <div id="reportsTab" class="tab-content" style="display: none;">
            <!-- Reports tab content -->
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <!-- JavaScript will go here -->
</body>
</html>
<!-- Add this inside the issueTab div -->
<div id="issueTab" class="tab-content active">
    <!-- Issue Form Card -->
    <div class="card">
        <h3 class="card-title">Issue Bicycle</h3>
        <form id="issueForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Room Number *</label>
                    <input type="text" class="form-control" id="roomNumber" required 
                           placeholder="Enter room number"
                           pattern="[0-9]+"
                           title="Please enter a valid room number">
                </div>
                <div class="form-group">
                    <label>Guest Name *</label>
                    <input type="text" class="form-control" id="guestName" required 
                           placeholder="Enter guest name">
                </div>
                <div class="form-group">
                    <label>Bicycle Type *</label>
                    <select class="form-control" id="bicycleType" required onchange="updateBicycleNumbers()">
                        <option value="">Select Bicycle Type</option>
                        <option value="regular">Regular Bicycle</option>
                        <option value="kids">Kids Bicycle</option>
                        <option value="libero">Libero Bicycle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bicycle Number *</label>
                    <select class="form-control" id="bicycleNumber" required>
                        <option value="">Select Bicycle Number</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Lock Code *</label>
                    <input type="text" class="form-control" id="lockCode" required 
                           pattern="[0-9]{4}" maxlength="4"
                           placeholder="Enter 4-digit code"
                           title="Please enter a 4-digit code">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Issue Date</label>
                    <input type="datetime-local" class="form-control" id="issueDate" required>
                </div>
                <div class="form-group">
                    <label>Return Date *</label>
                    <input type="date" class="form-control" id="returnDate" required>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" id="issueNotes" rows="2" 
                              placeholder="Any special requirements or notes"></textarea>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Issue Bicycle</button>
        </form>
    </div>

    <!-- Recent Issues Table -->
    <div class="card">
        <h3 class="card-title">Recent Issues</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Guest Name</th>
                        <th>Bicycle</th>
                        <th>Lock Code</th>
                        <th>Issue Date</th>
                        <th>Return Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recentIssuesTable">
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add this JavaScript -->
<script>
// Firebase Configuration
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "your-domain.firebaseapp.com",
    projectId: "your-project-id",
    storageBucket: "your-bucket.appspot.com",
    messagingSenderId: "your-sender-id",
    appId: "your-app-id"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Bicycle Inventory Data Structure
const bicycleInventory = {
    regular: Array.from({ length: 501 }, (_, i) => ({
        number: (1000 + i).toString(),
        type: 'Regular Bicycle',
        status: 'Available'
    })),
    kids: Array.from({ length: 100 }, (_, i) => ({
        number: `K${String(i + 1).padStart(2, '0')}`,
        type: 'Kids Bicycle',
        status: 'Available'
    })),
    libero: Array.from({ length: 40 }, (_, i) => ({
        number: `Libero ${String(i + 1).padStart(2, '0')}`,
        type: 'Libero Bicycle',
        status: 'Available'
    }))
};

// Initialize system
document.addEventListener('DOMContentLoaded', () => {
    // Set default issue date to current date/time
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('issueDate').value = now.toISOString().slice(0, 16);
    
    // Set default return date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('returnDate').value = tomorrow.toISOString().slice(0, 10);
    
    // Load recent issues
    loadRecentIssues();
});

// Update bicycle numbers based on selected type
function updateBicycleNumbers() {
    const typeSelect = document.getElementById('bicycleType');
    const numberSelect = document.getElementById('bicycleNumber');
    const selectedType = typeSelect.value;

    numberSelect.innerHTML = '<option value="">Select Bicycle Number</option>';

    if (selectedType) {
        const availableBikes = bicycleInventory[selectedType].filter(b => b.status === 'Available');
        availableBikes.forEach(bike => {
            const option = document.createElement('option');
            option.value = bike.number;
            option.textContent = bike.number;
            numberSelect.appendChild(option);
        });
    }
}

// Handle form submission
document.getElementById('issueForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        roomNumber: document.getElementById('roomNumber').value,
        guestName: document.getElementById('guestName').value,
        bicycleType: document.getElementById('bicycleType').value,
        bicycleNumber: document.getElementById('bicycleNumber').value,
        lockCode: document.getElementById('lockCode').value,
        issueDate: new Date(document.getElementById('issueDate').value).toISOString(),
        returnDate: new Date(document.getElementById('returnDate').value).toISOString(),
        notes: document.getElementById('issueNotes').value,
        status: 'Active',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
        // Validate return date
        if (new Date(formData.returnDate) < new Date(formData.issueDate)) {
            throw new Error('Return date cannot be earlier than issue date');
        }

        // Add to Firebase
        await db.collection('rentals').add(formData);
        
        // Update bicycle status
        updateBicycleStatus(formData.bicycleType, formData.bicycleNumber, 'In Use');
        
        showNotification('Bicycle issued successfully', 'success');
        e.target.reset();
        
        // Reset date fields to defaults
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('issueDate').value = now.toISOString().slice(0, 16);
        
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('returnDate').value = tomorrow.toISOString().slice(0, 10);
        
        loadRecentIssues();
        
    } catch (error) {
        console.error('Error issuing bicycle:', error);
        showNotification(error.message || 'Error issuing bicycle', 'error');
    }
});

// Load recent issues
function loadRecentIssues() {
    db.collection('rentals')
        .orderBy('timestamp', 'desc')
        .limit(10)
        .get()
        .then(snapshot => {
            const tbody = document.getElementById('recentIssuesTable');
            tbody.innerHTML = '';

            snapshot.forEach(doc => {
                const rental = doc.data();
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${rental.roomNumber}</td>
                    <td>${rental.guestName}</td>
                    <td>${rental.bicycleNumber}</td>
                    <td>${rental.lockCode}</td>
                    <td>${formatDate(rental.issueDate)}</td>
                    <td>${formatDate(rental.returnDate)}</td>
                    <td>
                        <span class="status-badge status-${rental.status.toLowerCase()}">
                            ${rental.status}
                        </span>
                    </td>
                    <td>
                        ${rental.status === 'Active' ? `
                            <button class="btn btn-success" 
                                    onclick="returnBicycle('${doc.id}')">Return</button>
                            <button class="btn btn-warning" 
                                    onclick="editRental('${doc.id}')">Edit</button>
                        ` : ''}
                    </td>
                `;
            });
        })
        .catch(error => {
            console.error("Error loading recent issues:", error);
            showNotification("Error loading recent issues", "error");
        });
}

// Return bicycle
async function returnBicycle(rentalId) {
    if (!confirm('Are you sure you want to return this bicycle?')) return;

    try {
        const rentalDoc = await db.collection('rentals').doc(rentalId).get();
        const rental = rentalDoc.data();

        await db.collection('rentals').doc(rentalId).update({
            status: 'Returned',
            actualReturnDate: new Date().toISOString()
        });

        updateBicycleStatus(rental.bicycleType, rental.bicycleNumber, 'Available');
        
        showNotification('Bicycle returned successfully', 'success');
        loadRecentIssues();
        
    } catch (error) {
        console.error('Error returning bicycle:', error);
        showNotification('Error returning bicycle', 'error');
    }
}

// Edit rental
function editRental(rentalId) {
    // Implementation for editing rental
    // You can add this functionality later if needed
    showNotification('Edit functionality coming soon', 'info');
}

// Update bicycle status
function updateBicycleStatus(type, number, status) {
    const typeKey = type.toLowerCase().split(' ')[0];
    const bike = bicycleInventory[typeKey].find(b => b.number === number);
    if (bike) {
        bike.status = status;
    }
    updateBicycleNumbers();
}

// Format date
function formatDate(dateString) {
    return new Date(dateString).toLocaleString('en-GB', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Show notification
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';

    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// Add validation for lock code
document.getElementById('lockCode').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4);
});

// Add validation for return date
document.getElementById('returnDate').addEventListener('change', function(e) {
    const issueDate = new Date(document.getElementById('issueDate').value);
    const returnDate = new Date(this.value);
    
    if (returnDate < issueDate) {
        showNotification('Return date cannot be earlier than issue date', 'error');
        // Set to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        this.value = tomorrow.toISOString().slice(0, 10);
    }
});
</script>
<!-- Add this inside the issueTab div -->
<div id="issueTab" class="tab-content active">
    <!-- Issue Form Card -->
    <div class="card">
        <h3 class="card-title">Issue Bicycle</h3>
        <form id="issueForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Room Number *</label>
                    <input type="text" class="form-control" id="roomNumber" required 
                           placeholder="Enter room number"
                           pattern="[0-9]+"
                           title="Please enter a valid room number">
                </div>
                <div class="form-group">
                    <label>Guest Name *</label>
                    <input type="text" class="form-control" id="guestName" required 
                           placeholder="Enter guest name">
                </div>
                <div class="form-group">
                    <label>Bicycle Type *</label>
                    <select class="form-control" id="bicycleType" required onchange="updateBicycleNumbers()">
                        <option value="">Select Bicycle Type</option>
                        <option value="regular">Regular Bicycle</option>
                        <option value="kids">Kids Bicycle</option>
                        <option value="libero">Libero Bicycle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bicycle Number *</label>
                    <select class="form-control" id="bicycleNumber" required>
                        <option value="">Select Bicycle Number</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Lock Code *</label>
                    <input type="text" class="form-control" id="lockCode" required 
                           pattern="[0-9]{4}" maxlength="4"
                           placeholder="Enter 4-digit code"
                           title="Please enter a 4-digit code">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Issue Date</label>
                    <input type="datetime-local" class="form-control" id="issueDate" required>
                </div>
                <div class="form-group">
                    <label>Return Date *</label>
                    <input type="date" class="form-control" id="returnDate" required>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" id="issueNotes" rows="2" 
                              placeholder="Any special requirements or notes"></textarea>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Issue Bicycle</button>
        </form>
    </div>

    <!-- Recent Issues Table -->
    <div class="card">
        <h3 class="card-title">Recent Issues</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Guest Name</th>
                        <th>Bicycle</th>
                        <th>Lock Code</th>
                        <th>Issue Date</th>
                        <th>Return Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recentIssuesTable">
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add this JavaScript -->
<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBjAGc8L0bkO_2RbWi0-rw7__lSHCoBrJQ",
        authDomain: "bicycle-issuing-system2.firebaseapp.com",
        projectId: "bicycle-issuing-system2",
        storageBucket: "bicycle-issuing-system2.firebasestorage.app",
        messagingSenderId: "64926990610",
        appId: "1:64926990610:web:f45390888ea1d0dfb5f3cb"
    };

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Bicycle Inventory Data Structure
const bicycleInventory = {
    regular: Array.from({ length: 501 }, (_, i) => ({
        number: (1000 + i).toString(),
        type: 'Regular Bicycle',
        status: 'Available'
    })),
    kids: Array.from({ length: 100 }, (_, i) => ({
        number: `K${String(i + 1).padStart(2, '0')}`,
        type: 'Kids Bicycle',
        status: 'Available'
    })),
    libero: Array.from({ length: 40 }, (_, i) => ({
        number: `Libero ${String(i + 1).padStart(2, '0')}`,
        type: 'Libero Bicycle',
        status: 'Available'
    }))
};

// Initialize system
document.addEventListener('DOMContentLoaded', () => {
    // Set default issue date to current date/time
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('issueDate').value = now.toISOString().slice(0, 16);
    
    // Set default return date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('returnDate').value = tomorrow.toISOString().slice(0, 10);
    
    // Load recent issues
    loadRecentIssues();
});

// Update bicycle numbers based on selected type
function updateBicycleNumbers() {
    const typeSelect = document.getElementById('bicycleType');
    const numberSelect = document.getElementById('bicycleNumber');
    const selectedType = typeSelect.value;

    numberSelect.innerHTML = '<option value="">Select Bicycle Number</option>';

    if (selectedType) {
        const availableBikes = bicycleInventory[selectedType].filter(b => b.status === 'Available');
        availableBikes.forEach(bike => {
            const option = document.createElement('option');
            option.value = bike.number;
            option.textContent = bike.number;
            numberSelect.appendChild(option);
        });
    }
}

// Handle form submission
document.getElementById('issueForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        roomNumber: document.getElementById('roomNumber').value,
        guestName: document.getElementById('guestName').value,
        bicycleType: document.getElementById('bicycleType').value,
        bicycleNumber: document.getElementById('bicycleNumber').value,
        lockCode: document.getElementById('lockCode').value,
        issueDate: new Date(document.getElementById('issueDate').value).toISOString(),
        returnDate: new Date(document.getElementById('returnDate').value).toISOString(),
        notes: document.getElementById('issueNotes').value,
        status: 'Active',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
        // Validate return date
        if (new Date(formData.returnDate) < new Date(formData.issueDate)) {
            throw new Error('Return date cannot be earlier than issue date');
        }

        // Add to Firebase
        await db.collection('rentals').add(formData);
        
        // Update bicycle status
        updateBicycleStatus(formData.bicycleType, formData.bicycleNumber, 'In Use');
        
        showNotification('Bicycle issued successfully', 'success');
        e.target.reset();
        
        // Reset date fields to defaults
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('issueDate').value = now.toISOString().slice(0, 16);
        
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('returnDate').value = tomorrow.toISOString().slice(0, 10);
        
        loadRecentIssues();
        
    } catch (error) {
        console.error('Error issuing bicycle:', error);
        showNotification(error.message || 'Error issuing bicycle', 'error');
    }
});

// Load recent issues
function loadRecentIssues() {
    db.collection('rentals')
        .orderBy('timestamp', 'desc')
        .limit(10)
        .get()
        .then(snapshot => {
            const tbody = document.getElementById('recentIssuesTable');
            tbody.innerHTML = '';

            snapshot.forEach(doc => {
                const rental = doc.data();
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${rental.roomNumber}</td>
                    <td>${rental.guestName}</td>
                    <td>${rental.bicycleNumber}</td>
                    <td>${rental.lockCode}</td>
                    <td>${formatDate(rental.issueDate)}</td>
                    <td>${formatDate(rental.returnDate)}</td>
                    <td>
                        <span class="status-badge status-${rental.status.toLowerCase()}">
                            ${rental.status}
                        </span>
                    </td>
                    <td>
                        ${rental.status === 'Active' ? `
                            <button class="btn btn-success" 
                                    onclick="returnBicycle('${doc.id}')">Return</button>
                            <button class="btn btn-warning" 
                                    onclick="editRental('${doc.id}')">Edit</button>
                        ` : ''}
                    </td>
                `;
            });
        })
        .catch(error => {
            console.error("Error loading recent issues:", error);
            showNotification("Error loading recent issues", "error");
        });
}

// Return bicycle
async function returnBicycle(rentalId) {
    if (!confirm('Are you sure you want to return this bicycle?')) return;

    try {
        const rentalDoc = await db.collection('rentals').doc(rentalId).get();
        const rental = rentalDoc.data();

        await db.collection('rentals').doc(rentalId).update({
            status: 'Returned',
            actualReturnDate: new Date().toISOString()
        });

        updateBicycleStatus(rental.bicycleType, rental.bicycleNumber, 'Available');
        
        showNotification('Bicycle returned successfully', 'success');
        loadRecentIssues();
        
    } catch (error) {
        console.error('Error returning bicycle:', error);
        showNotification('Error returning bicycle', 'error');
    }
}

// Edit rental
function editRental(rentalId) {
    // Implementation for editing rental
    // You can add this functionality later if needed
    showNotification('Edit functionality coming soon', 'info');
}

// Update bicycle status
function updateBicycleStatus(type, number, status) {
    const typeKey = type.toLowerCase().split(' ')[0];
    const bike = bicycleInventory[typeKey].find(b => b.number === number);
    if (bike) {
        bike.status = status;
    }
    updateBicycleNumbers();
}

// Format date
function formatDate(dateString) {
    return new Date(dateString).toLocaleString('en-GB', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Show notification
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';

    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// Add validation for lock code
document.getElementById('lockCode').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4);
});

// Add validation for return date
document.getElementById('returnDate').addEventListener('change', function(e) {
    const issueDate = new Date(document.getElementById('issueDate').value);
    const returnDate = new Date(this.value);
    
    if (returnDate < issueDate) {
        showNotification('Return date cannot be earlier than issue date', 'error');
        // Set to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        this.value = tomorrow.toISOString().slice(0, 10);
    }
});
</script>
<!-- Add this inside the returnTab div -->
<div id="returnTab" class="tab-content">
    <!-- Search Section -->
    <div class="card">
        <h3 class="card-title">Search Rentals</h3>
        <div class="form-row">
            <div class="form-group">
                <label>Search by Room Number</label>
                <input type="text" class="form-control" id="searchRoom" 
                       placeholder="Enter room number">
            </div>
            <div class="form-group">
                <label>Search by Bicycle Number</label>
                <input type="text" class="form-control" id="searchBicycle" 
                       placeholder="Enter bicycle number">
            </div>
            <div class="form-group" style="align-self: flex-end;">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="searchActiveRentals()">Search</button>
                <button class="btn btn-warning" onclick="resetSearch()">Reset</button>
            </div>
        </div>
    </div>

    <!-- Active Rentals Table -->
    <div class="card">
        <h3 class="card-title">Active Rentals</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Guest Name</th>
                        <th>Bicycle Type</th>
                        <th>Bicycle No.</th>
                        <th>Lock Code</th>
                        <th>Issue Date</th>
                        <th>Return Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="activeRentalsTable">
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Return Form Modal -->
    <div id="returnModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Return Bicycle</h3>
            <form id="returnForm">
                <input type="hidden" id="returnRentalId">
                <div class="form-group">
                    <label>Return Date</label>
                    <input type="datetime-local" class="form-control" id="actualReturnDate" required>
                </div>
                <div class="form-group">
                    <label>Condition</label>
                    <select class="form-control" id="returnCondition" required>
                        <option value="good">Good</option>
                        <option value="damaged">Damaged</option>
                        <option value="maintenance">Needs Maintenance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" id="returnNotes" rows="3" 
                              placeholder="Any issues or comments?"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Confirm Return</button>
                <button type="button" class="btn btn-danger" onclick="closeReturnModal()">Cancel</button>
            </form>
        </div>
    </div>
</div>

<!-- Add these styles -->
<style>
/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 20px;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    position: relative;
}

.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.close:hover {
    color: #333;
}

/* Enhanced Table Styles */
.table-container {
    position: relative;
    min-height: 200px;
}

.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    display: none;
}

.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3f51b5;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<!-- Add this JavaScript -->
<script>
// Return System Functions

// Load active rentals
function loadActiveRentals() {
    showLoading(true);
    db.collection('rentals')
        .where('status', '==', 'Active')
        .orderBy('issueDate', 'desc')
        .get()
        .then(snapshot => {
            const tbody = document.getElementById('activeRentalsTable');
            tbody.innerHTML = '';

            if (snapshot.empty) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center;">No active rentals found</td>
                    </tr>
                `;
                return;
            }

            snapshot.forEach(doc => {
                const rental = doc.data();
                const row = tbody.insertRow();
                const isOverdue = new Date(rental.returnDate) < new Date();
                
                row.innerHTML = `
                    <td>${rental.roomNumber}</td>
                    <td>${rental.guestName}</td>
                    <td>${rental.bicycleType}</td>
                    <td>${rental.bicycleNumber}</td>
                    <td>${rental.lockCode}</td>
                    <td>${formatDate(rental.issueDate)}</td>
                    <td class="${isOverdue ? 'text-danger' : ''}">
                        ${formatDate(rental.returnDate)}
                        ${isOverdue ? '<span class="badge badge-danger">Overdue</span>' : ''}
                    </td>
                    <td>
                        <button class="btn btn-success" 
                                onclick="openReturnModal('${doc.id}')">Return</button>
                        <button class="btn btn-warning" 
                                onclick="extendRental('${doc.id}')">Extend</button>
                    </td>
                `;
            });
        })
        .catch(error => {
            console.error("Error loading active rentals:", error);
            showNotification("Error loading active rentals", "error");
        })
        .finally(() => {
            showLoading(false);
        });
}

// Search active rentals
function searchActiveRentals() {
    const roomSearch = document.getElementById('searchRoom').value.toLowerCase();
    const bicycleSearch = document.getElementById('searchBicycle').value.toLowerCase();

    if (!roomSearch && !bicycleSearch) {
        showNotification('Please enter a search term', 'error');
        return;
    }

    showLoading(true);
    db.collection('rentals')
        .where('status', '==', 'Active')
        .get()
        .then(snapshot => {
            const tbody = document.getElementById('activeRentalsTable');
            tbody.innerHTML = '';

            let filteredRentals = [];
            snapshot.forEach(doc => {
                const rental = doc.data();
                if ((roomSearch && rental.roomNumber.toLowerCase().includes(roomSearch)) ||
                    (bicycleSearch && rental.bicycleNumber.toLowerCase().includes(bicycleSearch))) {
                    filteredRentals.push({ id: doc.id, ...rental });
                }
            });

            if (filteredRentals.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center;">No matching rentals found</td>
                    </tr>
                `;
                return;
            }

            filteredRentals.forEach(rental => {
                const row = tbody.insertRow();
                const isOverdue = new Date(rental.returnDate) < new Date();
                
                row.innerHTML = `
                    <td>${rental.roomNumber}</td>
                    <td>${rental.guestName}</td>
                    <td>${rental.bicycleType}</td>
                    <td>${rental.bicycleNumber}</td>
                    <td>${rental.lockCode}</td>
                    <td>${formatDate(rental.issueDate)}</td>
                    <td class="${isOverdue ? 'text-danger' : ''}">
                        ${formatDate(rental.returnDate)}
                        ${isOverdue ? '<span class="badge badge-danger">Overdue</span>' : ''}
                    </td>
                    <td>
                        <button class="btn btn-success" 
                                onclick="openReturnModal('${rental.id}')">Return</button>
                        <button class="btn btn-warning" 
                                onclick="extendRental('${rental.id}')">Extend</button>
                    </td>
                `;
            });
        })
        .catch(error => {
            console.error("Error searching rentals:", error);
            showNotification("Error searching rentals", "error");
        })
        .finally(() => {
            showLoading(false);
        });
}

// Reset search
function resetSearch() {
    document.getElementById('searchRoom').value = '';
    document.getElementById('searchBicycle').value = '';
    loadActiveRentals();
}

// Return modal functions
function openReturnModal(rentalId) {
    const modal = document.getElementById('returnModal');
    document.getElementById('returnRentalId').value = rentalId;
    
    // Set current date/time as default return date
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('actualReturnDate').value = now.toISOString().slice(0, 16);
    
    modal.style.display = 'block';
}

function closeReturnModal() {
    document.getElementById('returnModal').style.display = 'none';
    document.getElementById('returnForm').reset();
}

// Handle return form submission
document.getElementById('returnForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const rentalId = document.getElementById('returnRentalId').value;
    const returnData = {
        status: 'Returned',
        actualReturnDate: new Date(document.getElementById('actualReturnDate').value).toISOString(),
        returnCondition: document.getElementById('returnCondition').value,
        returnNotes: document.getElementById('returnNotes').value
    };

    try {
        // Get rental details
        const rentalDoc = await db.collection('rentals').doc(rentalId).get();
        const rental = rentalDoc.data();

        // Update rental status
        await db.collection('rentals').doc(rentalId).update(returnData);

        // Update bicycle status based on condition
        const newStatus = returnData.returnCondition === 'maintenance' ? 'Maintenance' : 'Available';
        updateBicycleStatus(rental.bicycleType, rental.bicycleNumber, newStatus);

        // If bicycle needs maintenance, create maintenance record
        if (returnData.returnCondition === 'maintenance' || 
            returnData.returnCondition === 'damaged') {
            await createMaintenanceRecord(rental, returnData.returnNotes);
        }

        showNotification('Bicycle returned successfully', 'success');
        closeReturnModal();
        loadActiveRentals();
        
    } catch (error) {
        console.error('Error returning bicycle:', error);
        showNotification('Error returning bicycle', 'error');
    }
});

// Create maintenance record
async function createMaintenanceRecord(rental, notes) {
    const maintenanceData = {
        bicycleType: rental.bicycleType,
        bicycleNumber: rental.bicycleNumber,
        issueType: 'Return Inspection',
        priority: 'medium',
        description: `Maintenance required after return. Notes: ${notes}`,
        reportedDate: new Date().toISOString(),
        status: 'pending'
    };

    try {
        await db.collection('maintenance').add(maintenanceData);
    } catch (error) {
        console.error('Error creating maintenance record:', error);
        showNotification('Error creating maintenance record', 'error');
    }
}

// Extend rental
async function extendRental(rentalId) {
    const newDate = prompt('Enter new return date (YYYY-MM-DD):');
    if (!newDate) return;

    try {
        const date = new Date(newDate);
        if (isNaN(date.getTime())) {
            throw new Error('Invalid date format');
        }

        await db.collection('rentals').doc(rentalId).update({
            returnDate: date.toISOString(),
            extensionDate: new Date().toISOString()
        });

        showNotification('Rental extended successfully', 'success');
        loadActiveRentals();
        
    } catch (error) {
        console.error('Error extending rental:', error);
        showNotification('Error extending rental. Please use YYYY-MM-DD format', 'error');
    }
}

// Loading indicator
function showLoading(show) {
    const overlay = document.querySelector('.loading-overlay');
    if (!overlay) return;
    
    overlay.style.display = show ? 'flex' : 'none';
}

// Initialize return tab
function initializeReturnTab() {
    loadActiveRentals();

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('returnModal');
        if (event.target === modal) {
            closeReturnModal();
        }
    };
}
</script>
<!-- Add this inside the maintenanceTab div -->
<div id="maintenanceTab" class="tab-content">
    <!-- Maintenance Status Overview -->
    <div class="card">
        <h3 class="card-title">Maintenance Overview</h3>
        <div class="status-overview">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="pendingCount">0</div>
                    <div class="status-label">Pending</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="inProgressCount">0</div>
                    <div class="status-label">In Progress</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="completedCount">0</div>
                    <div class="status-label">Completed Today</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="totalActiveCount">0</div>
                    <div class="status-label">Total Active Cases</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Maintenance Form -->
    <div class="card">
        <h3 class="card-title">Report Maintenance Issue</h3>
        <form id="maintenanceForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Bicycle Type *</label>
                    <select class="form-control" id="maintBicycleType" required onchange="updateMaintBicycleNumbers()">
                        <option value="">Select Type</option>
                        <option value="regular">Regular Bicycle</option>
                        <option value="kids">Kids Bicycle</option>
                        <option value="libero">Libero Bicycle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bicycle Number *</label>
                    <select class="form-control" id="maintBicycleNumber" required>
                        <option value="">Select Number</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Issue Type *</label>
                    <select class="form-control" id="issueType" required>
                        <option value="">Select Issue Type</option>
                        <option value="mechanical">Mechanical Issue</option>
                        <option value="electrical">Electrical Issue</option>
                        <option value="frame">Frame/Structure Damage</option>
                        <option value="tire">Tire/Wheel Issue</option>
                        <option value="brake">Brake System</option>
                        <option value="chain">Chain/Gear Issue</option>
                        <option value="seat">Seat/Handle Issue</option>
                        <option value="inspection">Regular Inspection</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority *</label>
                    <select class="form-control" id="priority" required>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Issue Description *</label>
                <textarea class="form-control" id="issueDescription" rows="3" required
                          placeholder="Detailed description of the issue..."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Estimated Repair Time (days)</label>
                    <input type="number" class="form-control" id="estimatedDays" min="1" value="1">
                </div>
                <div class="form-group">
                    <label>Notify Email</label>
                    <input type="email" class="form-control" id="notifyEmail"
                           placeholder="maintenance@example.com">
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" class="form-control" id="assignedTo"
                           placeholder="Maintenance staff name">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Submit Maintenance Request</button>
        </form>
    </div>

    <!-- Maintenance Records -->
    <div class="card">
        <div class="maintenance-header">
            <h3 class="card-title">Maintenance Records</h3>
            <div class="filter-controls">
                <select class="form-control" id="statusFilter" onchange="filterMaintenanceRecords()">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                </select>
                <select class="form-control" id="priorityFilter" onchange="filterMaintenanceRecords()">
                    <option value="all">All Priorities</option>
                    <option value="high">High Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="low">Low Priority</option>
                </select>
                <button class="btn btn-primary" onclick="printMaintenanceReport()">
                    <i class="fas fa-print"></i> Print Report
                </button>
            </div>
        </div>
        <div class="table-container">
            <div class="loading-overlay">
                <div class="loading-spinner"></div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Bicycle</th>
                        <th>Issue Type</th>
                        <th>Description</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Reported Date</th>
                        <th>Assigned To</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="maintenanceTable">
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Maintenance History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Maintenance History</h3>
            <div id="historyContent"></div>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Update Maintenance Status</h3>
            <form id="updateForm">
                <input type="hidden" id="updateRecordId">
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="updateStatus" required>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" id="updateNotes" rows="3" 
                              placeholder="Add notes about the update..."></textarea>
                </div>
                <div class="form-group">
                    <label>Parts Changed</label>
                    <input type="text" class="form-control" id="partsChanged" 
                           placeholder="List any parts that were changed">
                </div>
                <button type="submit" class="btn btn-primary">Update Status</button>
                <button type="button" class="btn btn-danger" onclick="closeUpdateModal()">Cancel</button>
            </form>
        </div>
    </div>
</div>

<!-- Add these styles -->
<style>
.status-overview {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.status-item {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.status-value {
    font-size: 28px;
    font-weight: bold;
    color: #3f51b5;
    margin-bottom: 5px;
}

.status-label {
    color: #666;
    font-size: 14px;
}

.maintenance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.filter-controls {
    display: flex;
    gap: 10px;
}

.priority-high {
    border-left: 4px solid #f44336;
}

.priority-medium {
    border-left: 4px solid #ff9800;
}

.priority-low {
    border-left: 4px solid #4caf50;
}

.history-item {
    padding: 15px;
    border-bottom: 1px solid #ddd;
}

.history-item:last-child {
    border-bottom: none;
}

.history-date {
    font-size: 12px;
    color: #666;
}

.history-status {
    font-weight: bold;
    margin: 5px 0;
}

.history-notes {
    font-size: 14px;
    color: #333;
}

@media (max-width: 768px) {
    .maintenance-header {
        flex-direction: column;
        gap: 10px;
    }

    .filter-controls {
        flex-direction: column;
        width: 100%;
    }
}
</style>

<!-- Add this JavaScript -->
<script>
// Maintenance System Functions

// Load maintenance statistics
function loadMaintenanceStats() {
    db.collection('maintenance')
        .get()
        .then(snapshot => {
            let stats = {
                pending: 0,
                inProgress: 0,
                completed: 0,
                total: 0
            };

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            snapshot.forEach(doc => {
                const record = doc.data();
                if (record.status === 'pending') stats.pending++;
                if (record.status === 'in-progress') stats.inProgress++;
                
                // Count completions for today only
                if (record.status === 'completed') {
                    const completedDate = new Date(record.completedDate);
                    if (completedDate >= today) {
                        stats.completed++;
                    }
                }

                if (record.status !== 'completed') stats.total++;
            });

            // Update statistics display
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('inProgressCount').textContent = stats.inProgress;
            document.getElementById('completedCount').textContent = stats.completed;
            document.getElementById('totalActiveCount').textContent = stats.total;
        })
        .catch(error => {
            console.error("Error loading maintenance stats:", error);
            showNotification("Error loading statistics", "error");
        });
}

// Update maintenance bicycle numbers
function updateMaintBicycleNumbers() {
    const typeSelect = document.getElementById('maintBicycleType');
    const numberSelect = document.getElementById('maintBicycleNumber');
    const selectedType = typeSelect.value;

    numberSelect.innerHTML = '<option value="">Select Number</option>';

    if (selectedType) {
        bicycleInventory[selectedType].forEach(bike => {
            const option = document.createElement('option');
            option.value = bike.number;
            option.textContent = bike.number;
            numberSelect.appendChild(option);
        });
    }
}

// Handle maintenance form submission
document.getElementById('maintenanceForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const maintenanceData = {
        bicycleType: document.getElementById('maintBicycleType').value,
        bicycleNumber: document.getElementById('maintBicycleNumber').value,
        issueType: document.getElementById('issueType').value,
        priority: document.getElementById('priority').value,
        description: document.getElementById('issueDescription').value,
        estimatedDays: document.getElementById('estimatedDays').value,
        notifyEmail: document.getElementById('notifyEmail').value,
        assignedTo: document.getElementById('assignedTo').value,
        status: 'pending',
        reportedDate: new Date().toISOString(),
        history: [{
            date: new Date().toISOString(),
            status: 'pending',
            notes: 'Maintenance issue reported'
        }]
    };

    try {
        // Add to Firebase
        await db.collection('maintenance').add(maintenanceData);
        
        // Update bicycle status
        updateBicycleStatus(maintenanceData.bicycleType, maintenanceData.bicycleNumber, 'Maintenance');
        
        // Send email notification if email provided
        if (maintenanceData.notifyEmail) {
            await sendMaintenanceNotification(maintenanceData);
        }

        showNotification('Maintenance request submitted successfully', 'success');
        e.target.reset();
        loadMaintenanceRecords();
        loadMaintenanceStats();
        
    } catch (error) {
        console.error('Error submitting maintenance request:', error);
        showNotification('Error submitting maintenance request', 'error');
    }
});

// Send maintenance notification
async function sendMaintenanceNotification(data) {
    // Implement your email notification system here
    // This is a placeholder for the email sending functionality
    console.log('Maintenance notification would be sent to:', data.notifyEmail);
}

// Load maintenance records
function loadMaintenanceRecords(statusFilter = 'all', priorityFilter = 'all') {
    showLoading(true);
    db.collection('maintenance')
        .orderBy('reportedDate', 'desc')
        .get()
        .then(snapshot => {
            const tbody = document.getElementById('maintenanceTable');
            tbody.innerHTML = '';

            snapshot.forEach(doc => {
                const record = doc.data();
                
                // Apply filters
                if (statusFilter !== 'all' && record.status !== statusFilter) return;
                if (priorityFilter !== 'all' && record.priority !== priorityFilter) return;

                const row = tbody.insertRow();
                row.classList.add(`priority-${record.priority}`);
                
                row.innerHTML = `
                    <td>${record.bicycleType} - ${record.bicycleNumber}</td>
                    <td>${record.issueType}</td>
                    <td>${record.description}</td>
                    <td>
                        <span class="status-badge priority-${record.priority}">
                            ${record.priority.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${record.status}">
                            ${record.status.toUpperCase()}
                        </span>
                    </td>
                    <td>${formatDate(record.reportedDate)}</td>
                    <td>${record.assignedTo || 'Not Assigned'}</td>
                    <td>
                        ${record.status
                          <!-- Add this inside the reportsTab div -->
<div id="reportsTab" class="tab-content">
    <!-- Reports Overview Cards -->
    <div class="reports-grid">
        <div class="report-card" onclick="generateDailyReport()">
            <div class="report-icon">📊</div>
            <div class="report-title">Daily Report</div>
            <div class="report-description">
                Summary of today's activities, including issues, returns, and maintenance
            </div>
        </div>

        <div class="report-card" onclick="showCustomReport('rental')">
            <div class="report-icon">📋</div>
            <div class="report-title">Rental Report</div>
            <div class="report-description">
                Detailed rental history with customizable date range
            </div>
        </div>

        <div class="report-card" onclick="showCustomReport('maintenance')">
            <div class="report-icon">🔧</div>
            <div class="report-title">Maintenance Report</div>
            <div class="report-description">
                Maintenance history and current status report
            </div>
        </div>

        <div class="report-card" onclick="showCustomReport('inventory')">
            <div class="report-icon">🚲</div>
            <div class="report-title">Inventory Status</div>
            <div class="report-description">
                Current status of all bicycles and their locations
            </div>
        </div>
    </div>

    <!-- Custom Report Generator -->
    <div class="card" id="customReportSection" style="display: none;">
        <h3 class="card-title">Generate Custom Report</h3>
        <div class="form-row">
            <div class="form-group">
                <label>Date Range</label>
                <select class="form-control" id="dateRange" onchange="handleDateRangeChange()">
                    <option value="today">Today</option>
                    <option value="yesterday">Yesterday</option>
                    <option value="thisWeek">This Week</option>
                    <option value="lastWeek">Last Week</option>
                    <option value="thisMonth">This Month</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            <div class="form-group" id="customDateRange" style="display: none;">
                <div class="date-range-picker">
                    <div>
                        <label>Start Date</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div>
                        <label>End Date</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Report Type</label>
                <select class="form-control" id="reportType" onchange="handleReportTypeChange()">
                    <option value="summary">Summary Report</option>
                    <option value="detailed">Detailed Report</option>
                </select>
            </div>
            <div class="form-group">
                <label>Export Format</label>
                <select class="form-control" id="exportFormat">
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                    <option value="print">Print</option>
                </select>
            </div>
        </div>
        <div class="form-row" id="reportOptions">
            <!-- Additional options will be populated based on report type -->
        </div>
        <button class="btn btn-primary" onclick="generateCustomReport()">Generate Report</button>
    </div>

    <!-- Report Preview -->
    <div class="card" id="reportPreview" style="display: none;">
        <div class="report-header">
            <h3 class="card-title">Report Preview</h3>
            <div class="report-actions">
                <button class="btn btn-success" onclick="exportReport()">Export</button>
                <button class="btn btn-primary" onclick="printReport()">Print</button>
            </div>
        </div>
        <div id="reportContent"></div>
    </div>
</div>

<!-- Add these styles -->
<style>
.reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.report-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.2s;
}

.report-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.report-icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.report-title {
    font-size: 18px;
    font-weight: bold;
    color: #3f51b5;
    margin-bottom: 10px;
}

.report-description {
    font-size: 14px;
    color: #666;
}

.date-range-picker {
    display: flex;
    gap: 15px;
}

.report-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.report-actions {
    display: flex;
    gap: 10px;
}

#reportContent {
    max-height: 600px;
    overflow-y: auto;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.report-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.report-table th,
.report-table td {
    padding: 12px;
    border: 1px solid #ddd;
}

.report-table th {
    background: #3f51b5;
    color: white;
}

.report-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.summary-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}

.summary-value {
    font-size: 24px;
    font-weight: bold;
    color: #3f51b5;
}

.summary-label {
    font-size: 14px;
    color: #666;
}

@media print {
    .report-actions {
        display: none;
    }

    #reportContent {
        max-height: none;
        overflow: visible;
    }
}
</style>

<!-- Add this JavaScript -->
<script>
// Reports System Functions

// Show custom report section
function showCustomReport(type) {
    const customReportSection = document.getElementById('customReportSection');
    customReportSection.style.display = 'block';
    document.getElementById('reportPreview').style.display = 'none';
    
    // Reset and update form based on report type
    updateReportOptions(type);
    scrollTo(customReportSection);
}

// Handle date range change
function handleDateRangeChange() {
    const dateRange = document.getElementById('dateRange').value;
    const customDateRange = document.getElementById('customDateRange');
    
    if (dateRange === 'custom') {
        customDateRange.style.display = 'block';
    } else {
        customDateRange.style.display = 'none';
        setDefaultDates(dateRange);
    }
}

// Set default dates based on selection
function setDefaultDates(range) {
    const startDate = document.getElementById('startDate');
    const endDate = document.getElementById('endDate');
    const today = new Date();
    
    switch(range) {
        case 'today':
            startDate.valueAsDate = today;
            endDate.valueAsDate = today;
            break;
        case 'yesterday':
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            startDate.valueAsDate = yesterday;
            endDate.valueAsDate = yesterday;
            break;
        case 'thisWeek':
            const thisWeekStart = new Date(today);
            thisWeekStart.setDate(today.getDate() - today.getDay());
            startDate.valueAsDate = thisWeekStart;
            endDate.valueAsDate = today;
            break;
        case 'lastWeek':
            const lastWeekStart = new Date(today);
            lastWeekStart.setDate(today.getDate() - today.getDay() - 7);
            const lastWeekEnd = new Date(lastWeekStart);
            lastWeekEnd.setDate(lastWeekStart.getDate() + 6);
            startDate.valueAsDate = lastWeekStart;
            endDate.valueAsDate = lastWeekEnd;
            break;
        case 'thisMonth':
            const thisMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            startDate.valueAsDate = thisMonthStart;
            endDate.valueAsDate = today;
            break;
    }
}

// Generate daily report
async function generateDailyReport() {
    try {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Get today's rentals
        const rentals = await db.collection('rentals')
            .where('issueDate', '>=', today.toISOString())
            .get();

        // Get today's returns
        const returns = await db.collection('rentals')
            .where('actualReturnDate', '>=', today.toISOString())
            .get();

        // Get today's maintenance
        const maintenance = await db.collection('maintenance')
            .where('reportedDate', '>=', today.toISOString())
            .get();

        const report = {
            rentals: rentals.size,
            returns: returns.size,
            maintenance: maintenance.size,
            rentalDetails: [],
            returnDetails: [],
            maintenanceDetails: []
        };

        rentals.forEach(doc => {
            report.rentalDetails.push(doc.data());
        });

        returns.forEach(doc => {
            report.returnDetails.push(doc.data());
        });

        maintenance.forEach(doc => {
            report.maintenanceDetails.push(doc.data());
        });

        displayReport(report, 'daily');
        
    } catch (error) {
        console.error('Error generating daily report:', error);
        showNotification('Error generating report', 'error');
    }
}

// Generate custom report
async function generateCustomReport() {
    const startDate = new Date(document.getElementById('startDate').value);
    const endDate = new Date(document.getElementById('endDate').value);
    const reportType = document.getElementById('reportType').value;

    try {
        const report = await fetchReportData(startDate, endDate, reportType);
        displayReport(report, reportType);
    } catch (error) {
        console.error('Error generating custom report:', error);
        showNotification('Error generating report', 'error');
    }
}

// Fetch report data
async function fetchReportData(startDate, endDate, type) {
    const report = {
        startDate,
        endDate,
        type,
        data: {}
    };

    // Fetch relevant data based on report type
    switch(type) {
        case 'rental':
            report.data.rentals = await fetchRentalData(startDate, endDate);
            break;
        case 'maintenance':
            report.data.maintenance = await fetchMaintenanceData(startDate, endDate);
            break;
        case 'inventory':
            report.data.inventory = await fetchInventoryData();
            break;
    }

    return report;
}

// Display report
function displayReport(report, type) {
    const reportContent = document.getElementById('reportContent');
    const reportPreview = document.getElementById('reportPreview');
    
    let html = `
        <div class="report-summary">
            ${generateReportSummary(report, type)}
        </div>
        <div class="report-details">
            ${generateReportDetails(report, type)}
        </div>
    `;

    reportContent.innerHTML = html;
    reportPreview.style.display = 'block';
    scrollTo(reportPreview);
}

// Generate report summary
function generateReportSummary(report, type) {
    let summaryHtml = '';
    
    switch(type) {
        case 'daily':
            summaryHtml = `
                <div class="summary-item">
                    <div class="summary-value">${report.rentals}</div>
                    <div class="summary-label">New Rentals</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">${report.returns}</div>
                    <div class="summary-label">Returns</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">${report.maintenance}</div>
                    <div class="summary-label">Maintenance Issues</div>
                </div>
            `;
            break;
        // Add other report types here
    }
    
    return summaryHtml;
}

// Generate report details
function generateReportDetails(report, type) {
    let detailsHtml = '';
    
    switch(type) {
        case 'daily':
            detailsHtml = `
                <h4>Today's Rentals</h4>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Room</th>
                            <th>Guest</th>
                            <th>Bicycle</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${report.rentalDetails.map(rental => `
                            <tr>
                                <td>${rental.roomNumber}</td>
                                <td>${rental.guestName}</td>
                                <td>${rental.bicycleNumber}</td>
                                <td>${formatTime(rental.issueDate)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>

                <h4>Today's Returns</h4>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Room</th>
                            <th>Guest</th>
                            <th>Bicycle</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${report.returnDetails.map(rental => `
                            <tr>
                                <td>${rental.roomNumber}</td>
                                <td>${rental.guestName}</td>
                                <td>${rental.bicycleNumber}</td>
                                <td>${formatTime(rental.actualReturnDate)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            break;
        // Add other report types here
    }
    
    return detailsHtml;
}

// Export report
function exportReport() {
    const format = document.getElementById('exportFormat').value;
    const content = document.getElementById('reportContent').innerHTML;
    
    switch(format) {
        case 'pdf':
            exportToPDF(content);
